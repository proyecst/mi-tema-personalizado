{% comment %}
  ==============================================================
  COMPONENT: Tarjeta de Producto (Product Card)
  Patrón de Diseño: Modular / Componente.
  
  Propiedades esperadas (pasadas al render):
 - product_card_product (objeto Liquid del producto)
  - show_badge (booleano: mostrar etiqueta de oferta/agotado)
  - grid_style (string: 'grid-style-1' o 'grid-style-2' para CSS)
  ==============================================================
{% endcomment %}

{%- liquid
  assign product = product_card_product  /* Renombramos la variable para claridad */

  if product == blank
    return /* Sale si no hay producto */
  endif

  /* Lógica de descuento o agotado */
  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif

  assign badge_text = ''
  if show_badge
    if product.available == false
      assign badge_text = 'Agotado'
    elsif on_sale
      assign badge_text = 'Oferta'
    endif
  endif
-%}

<div 
  class="product-card {{ grid_style }}"
  data-product-id="{{ product.id }}"
>
  <a href="{{ product.url | within: collection }}" class="product-card__link" aria-label="{{ product.title | escape }}">
    
    {% comment %} Etiqueta de Producto (Badge) {% endcomment %}
    {% if badge_text != blank %}
      <span class="product-card__badge product-card__badge--{{ badge_text | handle }}">
        {{ badge_text }}
      </span>
    {% endif %}

    {% comment %} Imagen del Producto {% endcomment %}
    <div class="product-card__image-wrapper">
      {% if product.featured_image != blank %}
        <img
          src="{{ product.featured_image | img_url: 'medium' }}"
          alt="{{ product.featured_image.alt | default: product.title | escape }}"
          class="product-card__image"
          loading="lazy"
        >
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: 'product-card__placeholder' }}
      {% endif %}
    </div>

    {% comment %} Título y Precio {% endcomment %}
    <h3 class="product-card__title">{{ product.title }}</h3>
    
    <div class="product-card__price">
      <span class="price-current">{{ product.price | money }}</span>
      {% if on_sale %}
        <span class="price-compare">{{ product.compare_at_price | money }}</span>
      {% endif %}
    </div>
    
  </a>
  
  {% comment %} Botón de Agregar al Carrito (Formulario rápido) {% endcomment %}
  {% render 'product-add-to-cart-quick', product: product %}
  
</div>

{% doc %}
  Renders a minimal product card snippet.

  @param {product} product - The product to render
  @example
  {% render 'product-card', product: product %}
{% enddoc %}

<a href="{{ product.url }}" class="product-card">
  {% if product.featured_image %}
    {{ product.featured_image | image_url: width: 400 | image_tag }}
  {% endif %}
  <h3 class="product-card__title">{{ product.title }}</h3>
  <div class="product-card__price">{{ product.price | money }}</div>
</a>

{% stylesheet %}
  .product-card { display:block; text-decoration:none; color:inherit; }
  .product-card__title { font-size:1rem; margin:0.5rem 0 0; }
{% endstylesheet %}
