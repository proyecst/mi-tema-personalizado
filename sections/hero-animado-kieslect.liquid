{%- style -%}
  .k-slider-{{ section.id }} {
    position: relative;
    width: 100%;
    height: {{ section.settings.height_desktop }}vh;
    background-color: #1a1a1a; /* Fondo gris oscuro por si falla la imagen */
    overflow: hidden;
  }

  @media screen and (max-width: 749px) {
    .k-slider-{{ section.id }} {
      height: {{ section.settings.height_mobile }}vh;
    }
  }

  .k-track {
    display: flex;
    width: 100%;
    height: 100%;
    transition: transform 0.5s ease-in-out;
  }

  .k-slide {
    min-width: 100%;
    height: 100%;
    flex-shrink: 0;
  }

  .k-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .k-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 20;
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 15px;
    cursor: pointer;
    font-size: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
  }

  .k-prev { left: 20px; }
  .k-next { right: 20px; }

  /* Si no hay bloques, mostrar mensaje de ayuda */
  .k-empty {
    color: white;
    text-align: center;
    padding: 50px;
    font-family: sans-serif;
  }
{%- endstyle -%}

<section class="k-slider-{{ section.id }}">
  {% if section.blocks.size > 0 %}
    <div class="k-track" id="Ktrack-{{ section.id }}">
      {% for block in section.blocks %}
        <div class="k-slide" {{ block.shopify_attributes }}>
          {% if block.settings.image != blank %}
            <img src="{{ block.settings.image | image_url: width: 2000 }}" alt="Kieslect">
          {% else %}
            <div class="k-empty">Imagen no seleccionada - Haz clic en el bloque para subir una</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    {% if section.blocks.size > 1 %}
      <button class="k-arrow k-prev" onclick="moveKSlider(-1, '{{ section.id }}')">❮</button>
      <button class="k-arrow k-next" onclick="moveKSlider(1, '{{ section.id }}')">❯</button>
    {% endif %}
  {% else %}
    <div class="k-empty">
      <h2>Banner Kieslect</h2>
      <p>Haz clic en <strong>"Agregar Imagen de Reloj"</strong> en el menú de la izquierda para ver el contenido.</p>
    </div>
  {% endif %}
</section>

<script>
  let kIndex = 0;
  function moveKSlider(direction, id) {
    const track = document.getElementById('Ktrack-' + id);
    const slides = track.querySelectorAll('.k-slide');
    kIndex = (kIndex + direction + slides.length) % slides.length;
    track.style.transform = 'translateX(-' + (kIndex * 100) + '%)';
  }

  // Auto-paso cada 4 segundos
  setInterval(() => {
    moveKSlider(1, '{{ section.id }}');
  }, 4000);
</script>

{% schema %}
{
  "name": "Kieslect Slider Pro",
  "max_blocks": 8,
  "settings": [
    { "type": "range", "id": "height_desktop", "min": 40, "max": 100, "step": 5, "unit": "vh", "label": "Altura PC", "default": 80 },
    { "type": "range", "id": "height_mobile", "min": 30, "max": 100, "step": 5, "unit": "vh", "label": "Altura Móvil", "default": 60 }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Imagen de Reloj",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagen" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Kieslect Slider Pro",
      "blocks": [
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}