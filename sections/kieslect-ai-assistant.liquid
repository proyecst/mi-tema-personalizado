<div class="ai-launcher" onclick="toggleAIChat()" id="aiLauncher">
  <div class="ai-pulse"></div>
  <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-10a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm11 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm-4.5 4.5c-1.66 0-3-1.34-3-3H7c0 2.76 2.24 5 5 5s5-2.24 5-5h-3c0 1.66-1.34 3-3 3z"/></svg>
</div>

<div id="ai-chat-box" class="ai-window">
  <div class="ai-header">
    <div class="ai-status">
      <div class="status-indicator"></div>
      <span>KIESLECT NEURAL CORE V.2</span>
    </div>
    <button onclick="toggleAIChat()" class="close-ai">✕</button>
  </div>
  
  <div id="ai-messages" class="ai-body">
    <div class="ai-msg bot">
      <small>SYSTEM ONLINE</small>
      Conexión establecida. Soy el asistente global de Kieslect. Puedo ayudarte con especificaciones, envíos, comparativas o soporte técnico. ¿Qué deseas consultar?
    </div>
  </div>

  <div class="ai-typing" id="aiTyping" style="display:none;">
    <span></span><span></span><span></span>
  </div>

  <div class="ai-footer">
    <input type="text" id="ai-input" placeholder="Escribe cualquier duda aquí..." onkeypress="handleEnter(event)">
    <button onclick="askAI()" id="sendBtn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
    </button>
  </div>
</div>

<style>
  :root { --k-neon: #00D1FF; --k-dark: #0d0d0d; --k-glass: rgba(255, 255, 255, 0.07); }
  .ai-launcher { position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; background: var(--k-dark); border: 2px solid var(--k-neon); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10000; box-shadow: 0 0 25px rgba(0,209,255,0.3); }
  .ai-pulse { position: absolute; width: 100%; height: 100%; border: 2px solid var(--k-neon); border-radius: 50%; animation: k-pulse-expand 2s infinite; }
  .ai-launcher svg { width: 32px; fill: var(--k-neon); }
  .ai-window { position: fixed; bottom: 110px; right: 30px; width: 380px; height: 550px; background: var(--k-dark); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; display: none; flex-direction: column; z-index: 10000; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.8); backdrop-filter: blur(20px); }
  .ai-header { padding: 20px; background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; }
  .ai-status { display: flex; align-items: center; gap: 10px; font-size: 10px; font-weight: 900; color: var(--k-neon); letter-spacing: 2px; }
  .status-indicator { width: 8px; height: 8px; background: var(--k-neon); border-radius: 50%; animation: blink 1s infinite; }
  .ai-body { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; scrollbar-width: none; }
  .ai-msg { padding: 12px 18px; border-radius: 18px; font-size: 14px; max-width: 85%; color: #fff; line-height: 1.4; }
  .ai-msg.bot { background: var(--k-glass); align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }
  .ai-msg.user { background: var(--k-neon); color: #000; align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 600; }
  .ai-footer { padding: 15px; display: flex; gap: 10px; background: rgba(0,0,0,0.3); }
  .ai-footer input { flex-grow: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; color: #fff; outline: none; }
  #sendBtn { background: var(--k-neon); border: none; width: 45px; border-radius: 12px; cursor: pointer; }
  @keyframes k-pulse-expand { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.6); opacity: 0; } }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
</style>

<script>
  const KNOWLEDGE_BASE = [
    { keywords: ["hola", "buenos", "quien eres"], resp: "Soy el núcleo de IA de Kieslect. Mi propósito es optimizar tu elección de wearables y resolver dudas técnicas. ¿En qué puedo asistirte?" },
    { keywords: ["precio", "cuanto vale", "costo"], resp: "Nuestros dispositivos tienen precios competitivos. Puedes ver los precios actuales en la sección de 'Catálogo'. ¿Buscas un modelo de entrada o uno profesional?" },
    { keywords: ["envio", "entrega", "donde esta", "llega"], resp: "Realizamos envíos a todo el país. El tiempo estimado es de 2 a 5 días hábiles. ¿Deseas rastrear un pedido?" },
    { keywords: ["agua", "piscina", "nadar", "ip68"], resp: "La mayoría de nuestros modelos como el KS Pro tienen certificación IP68. Son resistentes a inmersiones accidentales y sudor intenso." },
    { keywords: ["bateria", "duracion", "carga"], resp: "Nuestros relojes están optimizados para durar entre 5 y 9 días con una sola carga, dependiendo del uso de la pantalla Always-On." },
    { keywords: ["llamadas", "hablar", "contestar"], resp: "Los modelos con tecnología 'Calling' permiten responder y hacer llamadas directamente desde el reloj vía Bluetooth 5.2." },
    { keywords: ["garantia", "falla", "soporte"], resp: "Cuentas con garantía oficial Kieslect. Si tienes un problema técnico, puedo guiarte para contactar al servicio de post-venta." }
  ];

  function toggleAIChat() {
    const chat = document.getElementById('ai-chat-box');
    chat.style.display = (chat.style.display === 'flex') ? 'none' : 'flex';
  }

  function handleEnter(e) { if (e.key === 'Enter') askAI(); }

  function askAI() {
    const input = document.getElementById('ai-input');
    const msgContainer = document.getElementById('ai-messages');
    if (!input.value.trim()) return;

    // Agregar mensaje de usuario
    const userMsg = input.value;
    addMessage(userMsg, 'user');
    input.value = "";

    // Lógica de respuesta "Universal"
    setTimeout(() => {
      let finalResponse = "He analizado tu consulta. Para darte una respuesta exacta sobre eso, te sugiero revisar nuestra documentación técnica o contactar a un asesor humano aquí: [Soporte]. ¿Hay algo específico de los modelos KS o KR que quieras saber?";
      
      const query = userMsg.toLowerCase();

      // Buscar en base de datos local
      for (let item of KNOWLEDGE_BASE) {
        if (item.keywords.some(key => query.includes(key))) {
          finalResponse = item.resp;
          break;
        }
      }

      // Si pregunta algo que no sabe, intenta ser un asistente útil
      if (finalResponse.includes("He analizado") && query.length > 3) {
        finalResponse = `Entiendo que tu duda es sobre "${userMsg}". Como asistente Kieslect, mi base de datos indica que esa función/tema está relacionada con nuestro ecosistema. ¿Te gustaría que te redirija con un especialista en vivo?`;
      }

      addMessage(finalResponse, 'bot');
    }, 800);
  }

  function addMessage(text, type) {
    const msgContainer = document.getElementById('ai-messages');
    const div = document.createElement('div');
    div.className = `ai-msg ${type}`;
    div.innerHTML = type === 'bot' ? `<small>CORE RESPONSE</small>${text}` : text;
    msgContainer.appendChild(div);
    msgContainer.scrollTop = msgContainer.scrollHeight;
  }
</script>

{% schema %}
{
  "name": "Kieslect Universal AI",
  "settings": [],
  "presets": [{ "name": "Kieslect Universal AI" }]
}
{% endschema %}