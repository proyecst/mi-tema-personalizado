{%- style -%}
  .k-header-wrapper {
    width: 100%;
    background: #000;
    border-bottom: 1px solid #1a1a1a;
    position: sticky;
    top: 0;
    z-index: 9999;
    font-family: 'Inter', sans-serif;
  }
  .k-header-container {
    max-width: 1300px;
    height: 80px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
  }
  .k-logo a { 
    color: #fff; 
    text-decoration: none; 
    font-size: 24px; 
    font-weight: 900; 
    letter-spacing: 3px; 
    text-transform: uppercase; 
  }

  /* Estilo General de Dropdowns */
  .k-dropdown { position: relative; display: inline-block; }
  
  .k-drop-trigger {
    background: transparent;
    color: #fff;
    border: none;
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    cursor: pointer;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: 0.3s;
    opacity: 0.8;
  }
  .k-drop-trigger:hover { opacity: 1; color: #00D1FF; }

  /* Botón de Acceso (Diferente estilo) */
  .k-access-trigger {
    background: #00D1FF;
    color: #000;
    border-radius: 4px;
    font-weight: 800;
    opacity: 1;
  }
  .k-access-trigger:hover { background: #fff; color: #000; }

  .k-drop-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: #111;
    min-width: 200px;
    border: 1px solid #222;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.8);
    z-index: 100;
    padding: 10px 0;
  }
  .k-dropdown:hover .k-drop-menu { display: block; }
  
  /* Alineación a la derecha para el menú de usuario */
  .k-dropdown-right .k-drop-menu { left: auto; right: 0; }

  .k-drop-menu a, .k-drop-menu button {
    display: block;
    width: 100%;
    padding: 12px 20px;
    color: #fff;
    text-decoration: none;
    font-size: 11px;
    text-transform: uppercase;
    font-weight: 600;
    text-align: left;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  .k-drop-menu a:hover, .k-drop-menu button:hover {
    background: #00D1FF;
    color: #000;
  }

  /* Modal de Registro */
  .k-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 10001;
    align-items: center; justify-content: center;
  }
  .k-modal-box {
    background: #0a0a0a;
    padding: 30px;
    border-radius: 15px;
    border: 1px solid #222;
    width: 100%; max-width: 380px;
    position: relative;
  }
  .k-modal-box input {
    width: 100%; padding: 12px; margin-bottom: 10px;
    background: #111; border: 1px solid #333; color: #fff; border-radius: 5px;
    box-sizing: border-box;
  }
  .btn-submit-reg {
    width: 100%; background: #00D1FF; color: #000; border: none;
    padding: 12px; font-weight: 800; border-radius: 5px; cursor: pointer;
  }

  @media (max-width: 768px) { .k-nav-desktop { display: none; } }
{%- endstyle -%}

<div class="k-header-wrapper">
  <div class="k-header-container">
    
    <div class="k-logo"><a href="/">{{ section.settings.logo_text }}</a></div>
    
    <nav class="k-nav-desktop">
      <div class="k-dropdown">
        <button class="k-drop-trigger">
          Menú Principal <span>▼</span>
        </button>
        <div class="k-drop-menu">
          {%- for block in section.blocks -%}
            <a href="{{ block.settings.link_url | default: '#' }}" {{ block.shopify_attributes }}>
              {{ block.settings.link_text }}
            </a>
          {%- endfor -%}
        </div>
      </div>
    </nav>

    <div class="k-actions">
      <div class="k-dropdown k-dropdown-right">
        <button class="k-drop-trigger k-access-trigger">
          {%- if customer -%}
            Hola, {{ customer.first_name | upcase }}
          {%- else -%}
            Acceso
          {%- endif -%}
          <span>▼</span>
        </button>
        <div class="k-drop-menu">
          {%- if customer -%}
            <a href="/account">Mi Perfil</a>
            <a href="/account/orders">Mis Pedidos</a>
            <a href="/account/logout" style="color: #ff4d4d;">Cerrar Sesión</a>
          {%- else -%}
            <a href="/account/login">Iniciar Sesión</a>
            <button onclick="openModal()">Crear Cuenta Nueva</button>
          {%- endif -%}
        </div>
      </div>
    </div>

  </div>
</div>

<div id="kRegModal" class="k-modal">
  <div class="k-modal-box">
    <span style="position:absolute; top:15px; right:15px; color:#555; cursor:pointer;" onclick="closeModal()">&times;</span>
    <h3 style="color:#00D1FF; text-align:center; font-weight:900; margin-bottom:20px;">NUEVO USUARIO</h3>
    {%- form 'create_customer' -%}
      {{ form.errors | default_errors }}
      <input type="text" name="customer[first_name]" placeholder="Nombre" required>
      <input type="text" name="customer[last_name]" placeholder="Apellido" required>
      <input type="email" name="customer[email]" placeholder="Email" required>
      <input type="password" name="customer[password]" placeholder="Contraseña" required>
      <button type="submit" class="btn-submit-reg">GUARDAR Y REGISTRAR</button>
    {%- endform -%}
  </div>
</div>

<script>
  function openModal() { document.getElementById('kRegModal').style.display = 'flex'; }
  function closeModal() { document.getElementById('kRegModal').style.display = 'none'; }
  
  // Cerrar al hacer clic fuera
  window.onclick = function(e) {
    if (e.target == document.getElementById('kRegModal')) closeModal();
  }

  // Desplazamiento suave para links con #
  document.querySelectorAll('.k-drop-menu a').forEach(link => {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
        }
      }
    });
  });
</script>

{% schema %}
{
  "name": "Kieslect Header Ultimate",
  "settings": [
    { "type": "text", "id": "logo_text", "label": "Logo", "default": "KIESLECT" }
  ],
  "blocks": [
    {
      "type": "nav_link",
      "name": "Opción de Menú",
      "settings": [
        { "type": "text", "id": "link_text", "label": "Nombre", "default": "Nueva Sección" },
        { "type": "url", "id": "link_url", "label": "Link o #ID" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Kieslect Header Ultimate",
      "blocks": [
        { "type": "nav_link", "settings": { "link_text": "Inicio", "link_url": "#shopify-section-template--index-main" } },
        { "type": "nav_link", "settings": { "link_text": "Modelos", "link_url": "#shopify-section-featured-products" } },
        { "type": "nav_link", "settings": { "link_text": "Comunidad", "link_url": "#testi-list" } }
      ]
    }
  ]
}
{% endschema %}