<section class="series-destacadas-ia" id="series-ia-{{ section.id }}">
  <div class="container-width">
    {% if section.settings.title != blank %}
      <div class="heading-ia">
        <h2 class="title-ia">{{ section.settings.title }}</h2>
        <p class="subtitle-ia">Controlado por Inteligencia Artificial</p>
      </div>
    {% endif %}

    <div class="series-grid-ia" id="grid-principal">
      {% for block in section.blocks %}
        <div class="card-serie-ia" 
             data-name="{{ block.settings.title | downcase }}" 
             id="block-{{ block.id }}">
          <a href="{{ block.settings.link }}" class="card-link">
            <div class="img-container">
              {% if block.settings.image != blank %}
                <img src="{{ block.settings.image | img_url: '600x600' }}" alt="{{ block.settings.title }}">
              {% else %}
                {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}
              {% endif %}
              <div class="scan-line"></div>
            </div>
            <div class="info-ia">
              <h3>{{ block.settings.title }}</h3>
              <span class="status-bot">SISTEMA ONLINE</span>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<div class="ia-floating-panel">
  <div class="ia-chat-box" id="ia-box">
    <div class="ia-header-chat">KIESLECT CORE AI</div>
    <div class="ia-messages" id="ia-log">
      <div class="bot-txt">Escribe una serie (ej: "Amoled") y la buscaré por ti.</div>
    </div>
    <div class="ia-input-group">
      <input type="text" id="ia-input" placeholder="Comando de voz/texto..." onkeypress="if(event.key==='Enter') procesarOrden()">
      <button onclick="procesarOrden()">EXE</button>
    </div>
  </div>
  <div class="ia-btn-toggle" onclick="toggleIA()">
    <div class="ai-core"></div>
  </div>
</div>

<style>
  /* Base de la sección */
  .series-destacadas-ia { 
    background: #000; 
    padding: 60px 20px; 
    color: #fff; 
    font-family: 'Inter', sans-serif;
  }
  .heading-ia { text-align: center; margin-bottom: 50px; }
  .title-ia { color: #00D1FF; font-size: 3rem; font-weight: 900; margin: 0; text-transform: uppercase; }
  .subtitle-ia { color: #555; letter-spacing: 3px; font-size: 12px; }

  /* Rejilla */
  .series-grid-ia { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
    gap: 30px; 
    max-width: 1200px; 
    margin: 0 auto; 
  }

  /* Tarjetas */
  .card-serie-ia { 
    background: #0a0a0a; 
    border: 1px solid #1a1a1a; 
    border-radius: 20px; 
    overflow: hidden; 
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    position: relative;
  }
  .card-serie-ia.active-ia { border-color: #00D1FF; box-shadow: 0 0 30px rgba(0, 209, 255, 0.4); transform: scale(1.05); }
  .card-serie-ia.dim-ia { opacity: 0.2; filter: blur(2px); }

  .img-container { position: relative; aspect-ratio: 1; background: #111; overflow: hidden; }
  .img-container img { width: 100%; height: 100%; object-fit: cover; }
  
  /* Efecto de escaneo IA */
  .scan-line { 
    position: absolute; top: -100%; left: 0; width: 100%; height: 5px; 
    background: #00D1FF; box-shadow: 0 0 15px #00D1FF; opacity: 0; 
  }
  .active-ia .scan-line { animation: scanning 2s infinite; opacity: 1; }
  @keyframes scanning { 0% { top: 0%; } 100% { top: 100%; } }

  .info-ia { padding: 20px; text-align: center; }
  .status-bot { font-size: 9px; color: #00D1FF; border: 1px solid #00D1FF; padding: 2px 8px; border-radius: 4px; }

  /* Estilos del Panel IA */
  .ia-floating-panel { position: fixed; bottom: 30px; right: 30px; z-index: 10001; }
  .ia-btn-toggle { 
    width: 65px; height: 65px; background: #000; border: 2px solid #00D1FF; 
    border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 20px rgba(0, 209, 255, 0.4);
  }
  .ai-core { width: 20px; height: 20px; background: #00D1FF; border-radius: 50%; animation: pulse-core 1.5s infinite; }
  @keyframes pulse-core { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(2.5); opacity: 0; } }

  .ia-chat-box { 
    position: absolute; bottom: 85px; right: 0; width: 320px; background: #000; 
    border: 1px solid #333; border-radius: 20px; display: none; flex-direction: column; overflow: hidden;
  }
  .ia-chat-box.visible { display: flex; animation: slideIn 0.3s ease forwards; }
  @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

  .ia-header-chat { background: #00D1FF; color: #000; padding: 12px; font-weight: 900; font-size: 11px; text-align: center; }
  .ia-messages { height: 200px; padding: 15px; overflow-y: auto; color: #fff; font-size: 13px; }
  .bot-txt { background: #111; padding: 10px; border-radius: 10px; margin-bottom: 10px; border-left: 3px solid #00D1FF; }
  .ia-input-group { display: flex; padding: 10px; background: #080808; border-top: 1px solid #222; }
  .ia-input-group input { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 8px; outline: none; }
  .ia-input-group button { background: #00D1FF; border: none; padding: 0 15px; margin-left: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; }
</style>

<script>
function toggleIA() {
  document.getElementById('ia-box').classList.toggle('visible');
}

function procesarOrden() {
  const input = document.getElementById('ia-input');
  const log = document.getElementById('ia-log');
  const orden = input.value.toLowerCase().trim();
  const tarjetas = document.querySelectorAll('.card-serie-ia');
  
  if(!orden) return;

  log.innerHTML += `<div style="text-align:right; color:#00D1FF; margin-bottom:10px;">> ${input.value}</div>`;
  input.value = "";

  setTimeout(() => {
    let hallado = false;
    
    if(orden.includes("todo") || orden.includes("reiniciar") || orden.includes("limpiar")) {
      tarjetas.forEach(t => { t.classList.remove('dim-ia', 'active-ia'); });
      log.innerHTML += `<div class="bot-txt">Sistema reiniciado. Mostrando todas las series.</div>`;
    } else {
      tarjetas.forEach(t => {
        const nombre = t.getAttribute('data-name');
        if(nombre.includes(orden)) {
          t.classList.add('active-ia');
          t.classList.remove('dim-ia');
          t.scrollIntoView({ behavior: 'smooth', block: 'center' });
          hallado = true;
        } else {
          t.classList.add('dim-ia');
          t.classList.remove('active-ia');
        }
      });

      if(hallado) {
        log.innerHTML += `<div class="bot-txt">He localizado la serie "${orden}". He activado el escaneo de hardware.</div>`;
      } else {
        tarjetas.forEach(t => { t.classList.remove('dim-ia', 'active-ia'); });
        log.innerHTML += `<div class="bot-txt">No hay registros de "${orden}". Intenta con palabras clave como "Amoled" o "Deporte".</div>`;
      }
    }
    log.scrollTop = log.scrollHeight;
  }, 600);
}
</script>

{% schema %}
{
  "name": "Series IA Interactiva",
  "settings": [
    { "type": "text", "id": "title", "label": "Título", "default": "SERIES KIESLECT" }
  ],
  "blocks": [
    {
      "type": "serie",
      "name": "Serie",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagen" },
        { "type": "text", "id": "title", "label": "Nombre de la Serie" },
        { "type": "url", "id": "link", "label": "Enlace" }
      ]
    }
  ],
  "presets": [
    { "name": "Series IA Interactiva" }
  ]
}
{% endschema %}