<style>
  @import url('https://fonts.googleapis.com/css2?family=Michroma&display=swap');
</style>

{%- style -%}
  #shopify-section-{{ section.id }} {
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    --k-cyan: #00D1FF;
    --k-glass: rgba(255, 255, 255, 0.03);
    --k-border: rgba(255, 255, 255, 0.1);
    color: {{ section.settings.text_color }};
    overflow: hidden;
    font-family: sans-serif;
  }

  .testi-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

  /* --- FUENTE FUTURISTA APLICADA --- */
  .k-futurista {
    font-family: 'Michroma', sans-serif !important;
    text-transform: uppercase !important;
    letter-spacing: 2px !important;
  }

  .testi-title {
    text-align: center; 
    margin-bottom: 60px; 
    font-family: 'Michroma', sans-serif !important;
    font-size: clamp(1.5rem, 5vw, 2.5rem);
    font-weight: 700; 
    text-transform: uppercase; 
    letter-spacing: 6px !important;
    
    background: linear-gradient(120deg, rgba(255,255,255,0.1) 30%, var(--k-cyan) 50%, rgba(255,255,255,0.1) 70%);
    background-size: 200% 100%;
    -webkit-background-clip: text;
    background-clip: text;
    color: rgba(255, 255, 255, 0.9);
    animation: shineTitle 4s infinite linear;
  }

  .testi-title span { 
    color: var(--k-cyan); 
    display: block; 
    font-size: 0.35em; 
    letter-spacing: 8px; 
    margin-bottom: 15px;
    opacity: 0.8;
  }

  @keyframes shineTitle {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* --- TARJETAS --- */
  .testi-card {
    background: var(--k-glass); 
    backdrop-filter: blur(15px); 
    padding: 40px; 
    border-radius: 0px; /* Bordes rectos futuristas */
    border: 1px solid var(--k-border);
    display: flex; flex-direction: column; gap: 20px;
    transition: all 0.4s ease;
    width: 380px; flex-shrink: 0;
  }

  .testi-card:hover { border-color: var(--k-cyan); background: rgba(255,255,255,0.06); }

  .testi-stars { color: var(--k-cyan); font-size: 12px; letter-spacing: 4px; }
  
  .testi-text { 
    font-size: 1rem; 
    line-height: 1.6; 
    opacity: 0.8; 
    min-height: 80px; 
    font-family: sans-serif;
  }

  .user-name-txt {
    font-family: 'Michroma', sans-serif !important;
    font-size: 12px;
    letter-spacing: 1px;
    margin: 0;
    color: {{ section.settings.text_color }};
  }

  /* --- FORMULARIO --- */
  .form-wrapper { 
    max-width: 600px; 
    margin: 80px auto 0; 
    padding: 40px; 
    border: 1px solid var(--k-border); 
    background: rgba(255,255,255,0.02); 
  }

  .form-title {
    font-family: 'Michroma', sans-serif !important;
    font-size: 14px;
    text-align: center;
    margin-bottom: 30px;
    letter-spacing: 2px;
  }

  .form-wrapper input, .form-wrapper textarea {
    width: 100%; background: #111; border: 1px solid var(--k-border); 
    padding: 15px; color: #fff; margin-bottom: 15px; border-radius: 0; 
    font-family: sans-serif; outline: none;
  }

  .form-wrapper input:focus, .form-wrapper textarea:focus { border-color: var(--k-cyan); }

  .btn-kieslect {
    width: 100%; background: var(--k-cyan); color: #000; border: none; 
    padding: 20px; font-weight: 700; text-transform: uppercase; cursor: pointer;
    font-family: 'Michroma', sans-serif !important;
    font-size: 12px; letter-spacing: 2px;
    transition: 0.3s;
  }

  .btn-kieslect:hover { background: #fff; letter-spacing: 4px; }

  /* --- MARQUEE --- */
  .marquee-viewport { overflow: hidden; width: 100%; position: relative; }
  .testi-grid {
    display: flex; gap: 30px; padding: 20px 0; width: max-content;
    animation: scroll-kieslect {{ section.settings.speed }}s linear infinite;
  }
  @keyframes scroll-kieslect {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
{%- endstyle -%}

<div class="testi-container">
  <h2 class="testi-title"><span>USER EXPERIENCE</span>{{ section.settings.title }}</h2>

  <div class="marquee-viewport">
    <div id="testi-render-track" class="testi-grid">
      <div id="dynamic-reviews-container" style="display: flex; gap: 30px;"></div>
      
      {% capture original_blocks %}
        {% for block in section.blocks %}
          <div class="testi-card">
            <div class="testi-stars">★★★★★</div>
            <p class="testi-text">"{{ block.settings.review_text }}"</p>
            <div class="testi-user-info">
              <div>
                <p class="user-name-txt">{{ block.settings.user_name | uppercase }}</p>
                <small style="color:var(--k-cyan); font-weight:700; font-size: 9px; letter-spacing: 1px;">VERIFIED USER</small>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endcapture %}

      {{ original_blocks }}
      {{ original_blocks }}
    </div>
  </div>

  <div class="form-wrapper">
    <h3 class="form-title">Deja tu comentario</h3>
    <form id="kieslectForm">
      <input type="text" id="k-name" placeholder="Tu Nombre" required>
      <textarea id="k-text" placeholder="Escribe tu opinión aquí..." rows="4" required></textarea>
      <button type="submit" class="btn-kieslect">Publicar Comentario</button>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('kieslectForm');
  const container = document.getElementById('dynamic-reviews-container');

  function getCardHTML(name, text) {
    return `
      <div class="testi-card" style="border-color: #00D1FF;">
        <div class="testi-stars">★★★★★</div>
        <p class="testi-text">"${text}"</p>
        <div class="testi-user-info">
          <div>
            <p class="user-name-txt">${name.toUpperCase()}</p>
            <small style="color:#00D1FF; font-weight:700; font-size: 9px;">RECENT REVIEW</small>
          </div>
        </div>
      </div>`;
  }

  const saved = JSON.parse(localStorage.getItem('k_reviews') || '[]');
  saved.forEach(c => { container.innerHTML += getCardHTML(c.name, c.text); });

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('k-name').value;
    const text = document.getElementById('k-text').value;
    container.innerHTML = getCardHTML(name, text) + container.innerHTML;
    saved.push({name, text});
    localStorage.setItem('k_reviews', JSON.stringify(saved));
    form.reset();
  });
});
</script>

{% schema %}
{
  "name": "Comunidad Futurista",
  "settings": [
    { "type": "text", "id": "title", "label": "Título", "default": "COMUNIDAD" },
    { "type": "color", "id": "bg_color", "label": "Fondo", "default": "#000000" },
    { "type": "color", "id": "text_color", "label": "Texto", "default": "#ffffff" },
    { "type": "range", "id": "speed", "min": 10, "max": 60, "step": 1, "unit": "s", "label": "Velocidad Scroll", "default": 30 },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 1, "unit": "px", "label": "Padding Superior", "default": 80 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 1, "unit": "px", "label": "Padding Inferior", "default": 80 }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonio",
      "settings": [
        { "type": "text", "id": "user_name", "label": "Nombre", "default": "ALEX R." },
        { "type": "textarea", "id": "review_text", "label": "Comentario", "default": "Diseño Increíble." }
      ]
    }
  ],
  "presets": [
    { "name": "Comunidad Futurista" }
  ]
}
{% endschema %}