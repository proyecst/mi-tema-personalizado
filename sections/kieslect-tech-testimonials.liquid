{%- style -%}
  #shopify-section-{{ section.id }} {
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    --k-cyan: {{ section.settings.accent_color }};
    --k-glass: rgba(255, 255, 255, 0.05);
    --k-border: rgba(255, 255, 255, 0.1);
    color: {{ section.settings.text_color }};
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }

  .testi-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
  .testi-header { text-align: center; margin-bottom: 50px; }
  .testi-title { font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; text-transform: uppercase; margin: 0; letter-spacing: -1px; }

  /* Contenedor de Scroll Infinito */
  .marquee-viewport {
    display: flex;
    overflow: hidden;
    mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
  }

  .marquee-content {
    display: flex;
    gap: 30px;
    padding: 20px 0;
    animation: scroll-left {{ section.settings.speed }}s linear infinite;
  }

  @keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* Estilo de Tarjeta */
  .testi-card {
    background: var(--k-glass);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 30px;
    border-radius: 24px;
    border: 1px solid var(--k-border);
    width: 350px;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .testi-card:hover { transform: translateY(-10px); border-color: var(--k-cyan); }
  .testi-stars { color: var(--k-cyan); margin-bottom: 15px; font-size: 1.2rem; }
  .testi-text { font-size: 1rem; line-height: 1.5; opacity: 0.9; margin-bottom: 20px; min-height: 75px; }

  .testi-user { display: flex; align-items: center; gap: 12px; }
  .user-avatar { 
    width: 45px; height: 45px; border-radius: 50%; 
    background: var(--k-cyan); color: #000; 
    display: flex; align-items: center; justify-content: center; 
    font-weight: 900; font-size: 1.2rem;
  }

  /* Formulario */
  .review-form-box {
    max-width: 600px;
    margin: 50px auto 0;
    padding: 40px;
    background: rgba(255,255,255,0.02);
    border-radius: 30px;
    border: 1px solid var(--k-border);
  }
  .review-form-box input, .review-form-box textarea {
    width: 100%; padding: 15px; margin-bottom: 15px; 
    background: #111; border: 1px solid var(--k-border); 
    color: #fff; border-radius: 12px;
  }
  .btn-send {
    width: 100%; background: var(--k-cyan); color: #000; 
    border: none; padding: 15px; font-weight: 800; 
    border-radius: 12px; cursor: pointer; text-transform: uppercase;
  }
{%- endstyle -%}

<div class="testi-container">
  <div class="testi-header">
    <h2 class="testi-title">{{ section.settings.title }}</h2>
  </div>

  <div class="marquee-viewport">
    <div id="testi-track" class="marquee-content">
      {%- comment -%} Se repite el loop dos veces para el efecto infinito real {%- endcomment -%}
      {% for i in (1..2) %}
        {% for block in section.blocks %}
          <div class="testi-card" {{ block.shopify_attributes }}>
            <div class="testi-stars">★★★★★</div>
            <p class="testi-text">"{{ block.settings.review_text }}"</p>
            <div class="testi-user">
              <div class="user-avatar">{{ block.settings.user_name | slice: 0 }}</div>
              <div>
                <strong style="display:block;">{{ block.settings.user_name }}</strong>
                <small style="color: var(--k-cyan);">CLIENTE VERIFICADO</small>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endfor %}
    </div>
  </div>

  <div class="review-form-box">
    <h3 style="text-align:center; margin-bottom:25px;">COMPARTE TU EXPERIENCIA</h3>
    <form id="liveReviewForm">
      <input type="text" id="reviewerName" placeholder="Tu nombre" required>
      <textarea id="reviewerText" placeholder="¿Qué te pareció el producto?" rows="3" required></textarea>